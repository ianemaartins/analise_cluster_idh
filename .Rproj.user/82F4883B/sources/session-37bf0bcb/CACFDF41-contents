# ESTADOS

# Loop para filtrar os dados por ano, realizar a clusterização hierárquica, plotar e salvar os dendrogramas
for (ano in 2013:2022) {
  
  # Filtrar os dados por ano
  dados_ano_est <- dados_idh_estados %>%
    filter(ANOOBITO == ano)
  
  # Escalonar as variáveis IDH e taxa de mortalidade
  dados_cluster_ano_est <- dados_ano_est %>%
    select(mortalidade_C2010, IDHM) %>%
    mutate(across(everything(), as.numeric)) %>%
    scale()
  
  # Calcular a matriz de distância
  dist_ano_est <- dist(dados_cluster_ano_est, method = "euclidean")
  
  # Realizar a clusterização hierárquica
  hc_ano_est <- hclust(dist_ano_est, method = "ward.D2")
  
  # Plotar o dendrograma
  dendrograma_plot <- plot(hc_ano_est, labels = dados_ano_est$Estado, 
                           main = paste("Dendrograma de Clusterização Hierárquica (Estados) -", ano), 
                           xlab = "", ylab = "Altura")
  
  # Cortar o dendrograma para formar um número apropriado de clusters
  rect.hclust(hc_ano_est, k = 5, border = 2:6)
  
  # Salvar o dendrograma como um arquivo PNG
  png(filename = paste0("dendrograma_est_", ano, ".png"))
  plot(hc_ano_est, labels = dados_ano_est$Estado, 
       main = paste("Dendrograma de Clusterização Hierárquica (Estados) -", ano), 
       xlab = "", ylab = "Altura")
  rect.hclust(hc_ano_est, k = 5, border = 2:6)
  dev.off()
  
  # Adicionar os clusters ao data frame original
  dados_ano_est$cluster_hc <- cutree(hc_ano_est, k = 5)
  
  # Visualizar os clusters para o ano específico
  cluster_plot <- ggplot(dados_ano_est, aes(x = IDHM, y = mortalidade_C2010, color = as.factor(cluster_hc))) +
    geom_point(size = 2) +
    labs(color = "Cluster", y = "Taxa de Mortalidade", x = "IDH") +
    theme_minimal() +
    ggtitle(paste("Clusterização Hierárquica: IDH e Taxa de Mortalidade dos Estados -", ano))
  
  # Exibir o gráfico
  print(cluster_plot)
  
  # Salvar o gráfico dos clusters como um arquivo PNG
  ggsave(filename = paste0("cluster_hierarquico_est_", ano, ".png"), plot = cluster_plot)
}





# MUNICIPIOS

for (ano in 2013:2022) {
  
  # Filtrar os dados por ano
  dados_ano_mun <- dados_idh_municipios %>%
    filter(ANOOBITO == ano)
  
  # Escalonar as variáveis IDH e taxa de mortalidade
  dados_cluster_ano_mun <- dados_ano_mun %>%
    select(mortalidade_tot_C2010, IDHM) %>%
    mutate(across(everything(), as.numeric)) %>%
    scale()
  
  # Calcular a matriz de distância
  dist_ano_mun <- dist(dados_cluster_ano_mun, method = "euclidean")
  
  # Realizar a clusterização hierárquica
  hc_ano_mun <- hclust(dist_ano_mun, method = "ward.D2")
  
  # Plotar o dendrograma
  dendrograma_plot_mun <- plot(hc_ano_mun, labels = dados_ano_mun$Municipio, 
                               main = paste("Dendrograma de Clusterização Hierárquica (Municipios) -", ano), 
                               xlab = "", ylab = "Altura")
  
  # Cortar o dendrograma para formar um número apropriado de clusters
  rect.hclust(hc_ano_mun, k = 3, border = 2:4)
  
  # Salvar o dendrograma como um arquivo PNG
  png(filename = paste0("dendrograma_mun_", ano, ".png"))
  plot(hc_ano_mun, labels = dados_ano_mun$Municipio, 
       main = paste("Dendrograma de Clusterização Hierárquica (Municipios) -", ano), 
       xlab = "", ylab = "Altura")
  rect.hclust(hc_ano_mun, k = 3, border = 2:4)
  dev.off()
  
  # Adicionar os clusters ao data frame original
  dados_ano_mun$cluster_hc_mun <- cutree(hc_ano_mun, k = 3)
  
  # Visualizar os clusters para o ano específico
  cluster_plot_mun <- ggplot(dados_ano_mun, aes(x = IDHM, y = mortalidade_tot_C2010, color = as.factor(cluster_hc_mun))) +
    geom_point(size = 2) +
    labs(color = "Cluster", y = "Taxa de Mortalidade", x = "IDH") +
    theme_minimal() +
    ggtitle(paste("Clusterização Hierárquica: IDH e Taxa de Mortalidade dos Municipios do ES -", ano))
  
  # Exibir o gráfico
  print(cluster_plot_mun)
  
  # Salvar o gráfico dos clusters como um arquivo PNG
  ggsave(filename = paste0("cluster_hierarquico_mun_", ano, ".png"), plot = cluster_plot_mun)
}
